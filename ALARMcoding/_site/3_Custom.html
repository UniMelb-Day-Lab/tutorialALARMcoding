<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Step 3: Processing in R – ALARMcoding Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./2_MACSE.html" rel="prev">
<link href="./Images/ALARMcoding_Icon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ALARMcoding Tutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="./About.qmd"> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://twitter.com/DionneArgy" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/UniMelb-Day-Lab">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/UniMelb-Day-Lab">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./1_SeekDeep.html">Drug Resistance Pipeline</a></li><li class="breadcrumb-item"><a href="./3_Custom.html">Step 3: Processing in R</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./Images/ALARMcoding_Icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">About ALARMcoding</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./About_Resistance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Antimalarial Drug Resistance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./About_Markers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marker Choice</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">PCR Protocol</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PCR_Important.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PCR: Important Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Multiplex_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiplex 1: K13 and mdr1 (86, 184)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Multiplex_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiplex 2: crt, mdr1 (1034, 1042, 1246)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Multiplex_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiplex 3: dhfr, dhps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Multiplex_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiplex 4: aat1, pfs47</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Prepare_Sequencing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Post-PCR: Prepare for Sequencing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Drug Resistance Pipeline</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_SeekDeep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step 1: SeekDeep</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_MACSE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step 2: MACSE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_Custom.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Step 3: Processing in R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#seekdeep-and-macse-outputs" id="toc-seekdeep-and-macse-outputs" class="nav-link active" data-scroll-target="#seekdeep-and-macse-outputs">SeekDeep and MACSE Outputs:</a></li>
  <li><a href="#r-processing-guide" id="toc-r-processing-guide" class="nav-link" data-scroll-target="#r-processing-guide">R Processing Guide</a></li>
  <li><a href="#step-01-macse-to-r" id="toc-step-01-macse-to-r" class="nav-link" data-scroll-target="#step-01-macse-to-r">Step 01 : MACSE to R</a></li>
  <li><a href="#step-02-r-cleaning" id="toc-step-02-r-cleaning" class="nav-link" data-scroll-target="#step-02-r-cleaning">Step 02: R Cleaning</a>
  <ul class="collapse">
  <li><a href="#process-sequence-data" id="toc-process-sequence-data" class="nav-link" data-scroll-target="#process-sequence-data">Process Sequence Data</a></li>
  <li><a href="#process-codon-match-data" id="toc-process-codon-match-data" class="nav-link" data-scroll-target="#process-codon-match-data">Process Codon Match Data</a></li>
  <li><a href="#process-codon-differences" id="toc-process-codon-differences" class="nav-link" data-scroll-target="#process-codon-differences">Process Codon Differences</a></li>
  <li><a href="#join-data" id="toc-join-data" class="nav-link" data-scroll-target="#join-data">Join Data</a></li>
  </ul></li>
  <li><a href="#step-03-specific-changes-dhps-2-and-mdr1-2" id="toc-step-03-specific-changes-dhps-2-and-mdr1-2" class="nav-link" data-scroll-target="#step-03-specific-changes-dhps-2-and-mdr1-2">Step 03: Specific Changes: dhps-2 and mdr1-2</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./1_SeekDeep.html">Drug Resistance Pipeline</a></li><li class="breadcrumb-item"><a href="./3_Custom.html">Step 3: Processing in R</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Step 3: Processing in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="seekdeep-and-macse-outputs" class="level2">
<h2 class="anchored" data-anchor-id="seekdeep-and-macse-outputs">SeekDeep and MACSE Outputs:</h2>
<p>The final outputs from MASCE (“_NT.fasta” or “_AA.fasta”) and SeekDeep (“selectedClustersInfo.tab.txt”) are as follows:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">MACSE</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">SeekDeep</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Here you have the sample name (seq_name) and the sequence (sequence).</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 13. Example of MACSE output</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">seq_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">sequence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PF3D7_0709000</td>
<td style="text-align: left;">MKFASKKNNQKNSSKNDERYRELDNLVQEGNGSRLGGGSCLGKCAHVFKLIFKEIKDNIFIYILSIIYLSVCVMNKIFAKRTLNKIGNYSFVTSETHNFICMIMFFIVYSLFGNKKGNSKERHRSFNLQFFAISMLDACSVILAFIGLTRTTGNIQSFVLQLSIPINMFFCFLILRYRYHLYNYLGAVIIVVTIALVEMKLSFETQEENSIIFNLVLISALIPVCFSNMTREIVFKKYKIDILRLNAMVSFFQLFTSCLILPVYTLPFLKQLHLPYNEIWTNIKNGFACLFLGRNTVVENCGLGMAKLCDDCDGAWKTFALFSFFNICDNLITSYIIDKFSTMTYTIVSCIQGPAIAIAYYFKFLAGDVVREPRLLDFVTLFGYLFGSIIYRVGNIILERKKMRNEENEDSEGELTNVDSIITQ*</td>
</tr>
<tr class="even">
<td style="text-align: left;">3D7.MID108.Pool1.0_f1</td>
<td style="text-align: left;">---------------------------------------!LGKCAHVFKLIFKEIKDNIFIYILSIIYLSVCVMNKIFAKRTLNKIGNYSF----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SAMPLE1.MID1.Pool1.0_f1</td>
<td style="text-align: left;">---------------------------------------!LGKCAHVFKLIFKEIKDNIFIYILSIIYLSVCVMNKIFAKRTLNKIGNYSF----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</td>
</tr>
<tr class="even">
<td style="text-align: left;">SAMPLE2.MID2.Pool1.0_f1</td>
<td style="text-align: left;">---------------------------------------!LGKCAHVFKLIFKEIKDNIFIYILSIIYLSVCVMNKIFAKRTLNKIGNYSF----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SAMPLE3.MID3.Pool1.0_f0.7328</td>
<td style="text-align: left;">---------------------------------------!LGKCAHVFKLIFKEIKDNIFIYILSIIYLSVCVMNKIFAKRTLNKIGNYSF----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</td>
</tr>
<tr class="even">
<td style="text-align: left;">SAMPLE3.MID3.Pool1.1_f0.2672</td>
<td style="text-align: left;">---------------------------------------!LGKCAHVFKLIFKEIKDNIFIYILSIIYLSVCVIETIFAKRTLNKIGNYSF----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>The key variables of interest from the SeekDeep outputs include:</p>
<ul>
<li>The suffix in the s_SampleID column:
<ul>
<li><code>.0_f1</code>: 0 = Major Haplotype, f1 = 100% of the isolate</li>
<li><code>.0_f0.7328</code> 0 = Major Haplotype, f0.7328 = 73.28% of the isolate</li>
<li><code>.1_f0.2672</code> 1 = Minor Haplotype, f0.2672 = 26.72% of the isolate</li>
</ul></li>
<li>h_popUID: Same numbers as the major and minor haplotypes denoted in that suffix</li>
<li>c_ReadCnt: Read Count per amplicon/haplotype</li>
</ul>
<p>Note, “Marker” was a user-generated column to denote which marker these data are attributed to e.g., crt.</p>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-condensed caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 14. Example of SeekDeep output</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Marker</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">s_Sample</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">h_popUID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">c_ReadCnt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">crt</td>
<td style="text-align: left;">3D7.MID108.Pool1.0_f1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">2205</td>
</tr>
<tr class="even">
<td style="text-align: left;">crt</td>
<td style="text-align: left;">SAMPLE1.MID1.Pool1.0_f1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1772</td>
</tr>
<tr class="odd">
<td style="text-align: left;">crt</td>
<td style="text-align: left;">SAMPLE2.MID2.Pool1.0_f1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">4368</td>
</tr>
<tr class="even">
<td style="text-align: left;">crt</td>
<td style="text-align: left;">SAMPLE3.MID3.Pool1.0_f0.7328</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">3789</td>
</tr>
<tr class="odd">
<td style="text-align: left;">crt</td>
<td style="text-align: left;">SAMPLE3.MID3.Pool1.1_f0.2672</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">2682</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</div>
</div>
</div>
</section>
<section id="r-processing-guide" class="level2">
<h2 class="anchored" data-anchor-id="r-processing-guide">R Processing Guide</h2>
<p>Our goal now is to interpret these results. The following code was used to process the data.</p>
<p>Create the following folders in a repository:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: { 'logLevel': 'debug', 'theme': 'base' } }%%
gitGraph
  commit id: "01_SeekDeep_Output"
  commit id: "02_MACSE_Output_AA"
  commit id: "02_MACSE_Output_NT"
  commit id: "03_DrugR_AA_Sequences"
  commit id: "03_DrugR_NT_Sequences"
  commit id: "03_DrugR_AA_Changes"
  commit id: "03_DrugR_NT_Changes"
  commit id: "04_Compiled_AA_Sequences"
  commit id: "04_Compiled_NT_Sequences"
  commit id: "05_All_DrugR_AA_Sequences"
  commit id: "05_All_DrugR_NT_Sequences"
  commit id: "05_All_DrugR_Haplotypes"
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li><strong>01_SeekDeep_Output</strong>: Contains <code>extractionStats.tab.txt</code>, <code>selectedClustersInfo.tab.txt</code>, <code>extractionProfile.tab.txt</code> files for each pool and marker output from SeekDeep. This can be used at your own discretion to match processed sequences with read count data etc.</li>
<li><strong>02_MACSE_Output_AA</strong>: Contains all <code>_AA.fasta</code> files output from MACSE.</li>
<li><strong>02_MACSE_Output_NT</strong>: Contains all <code>_NT.fasta</code> files output from MACSE.</li>
<li><strong>03_DrugR_AA_Sequences</strong>: Output of processed amino acid files created from <code>Step_01_MACSE_to_R.qmd</code>.</li>
<li><strong>03_DrugR_NT_Sequences</strong>: Output of processed nucleotide files created from <code>Step_01_MACSE_to_R.qmd</code>.</li>
<li><strong>03_DrugR_AA_Changes</strong>: Output of processed non-synonymous changes files created from <code>Step_01_MACSE_to_R.qmd</code>.</li>
<li><strong>03_DrugR_NT_Changes</strong>: Output of processed synonymous and non-synonymous changes files created from <code>Step_01_MACSE_to_R.qmd</code>.</li>
<li><strong>04_Compiled_AA_Sequences</strong>: Output of compiling all amino acid files together created from <code>Step_01_MACSE_to_R.qmd</code>.</li>
<li><strong>04_Compiled_NT_Sequences</strong>: Output of compiling all nucleotide files together created from <code>Step_01_MACSE_to_R.qmd</code>.</li>
<li><strong>05_All_DrugR_AA_Sequences</strong>: Output of cleaned amino acid files created from <code>Step_02_R_Cleaning.qmd</code>.</li>
<li><strong>05_All_DrugR_NT_Sequences</strong>: Output of cleaned nucleotide files created from <code>Step_02_R_Cleaning.qmd</code>.</li>
<li><strong>05_All_DrugR_Haplotypes</strong>: Output of cleaned condensed haplotype files created from <code>Step_02_R_Cleaning.qmd</code>.</li>
</ul>
</section>
<section id="step-01-macse-to-r" class="level2">
<h2 class="anchored" data-anchor-id="step-01-macse-to-r">Step 01 : MACSE to R</h2>
<p>First we wish to process the MACSE output data with the suffix “_NT.fasta” and “_AA.fasta”. This involves:</p>
<ol type="1">
<li>Aligning to the reference genome e.g., 3D7, Dd2 and HB3 to gain the <strong>position</strong> of each codon.</li>
<li>For <strong>nucleotide</strong> processing: Ensure columns are created for each codon: each 3 characters, i.e., nucleotides.</li>
<li>For <strong>amino acid</strong> processing: Ensure columns are created for each codon: each 1 character, i.e., amino acid.</li>
</ol>
<p>INPUTS:</p>
<ul>
<li>“_NT.fasta” files: MACSE output</li>
<li>“_AA.fasta” files: MACSE output</li>
</ul>
<p>OUTPUTS:</p>
<ul>
<li><p>“_NT_Aligned.csv”: Data frame of aligned sequences to the 3D7 reference genome where each codon represented by a unique column.</p></li>
<li><p>“_NT_Aligned_YorN.csv”: Data frame of whether the codon MATCHES YES (Y) or NO (N) the 3D7 reference.</p></li>
<li><p>“_NT_Aligned_NTchange.csv”: Data frame of when codons DID NOT MATCH 3D7 reference and what the nature of the change is.</p></li>
<li><p>“_AA_Aligned.csv”: Data frame of aligned sequences to the 3D7 reference genome where each codon represented by a unique column.</p></li>
<li><p>“_AA_Aligned_YorN.csv”: Data frame of whether the codon MATCHES YES (Y) or NO (N) the 3D7 reference.</p></li>
<li><p>“_AA_Aligned_NTchange.csv”: Data frame of when codons DID NOT MATCH 3D7 reference and what the nature of the change is.</p></li>
</ul>
<p>After we have processed each .fasta file to a .csv file, we can (1, 2) merge all .csv files per marker for NT (nucleotide) sequences and AA (amino acid) sequences and (3) write the .csv file for these merged files.</p>
</section>
<section id="step-02-r-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="step-02-r-cleaning">Step 02: R Cleaning</h2>
<p>The aim of this <code>.qmd</code> is to manipulate the <strong>processed</strong> MACSE files into files that contain variables of interest (e.g., <strong>Survey</strong>, <strong>Marker</strong>) and separate files for <strong>Controls</strong>, <strong>Repeats</strong> and <strong>Isolates</strong>. Further, this notebook will calculate the number of <strong>synonymous</strong> and <strong>non-synonymous</strong> mutations per isolate/sample and contain a column with all of the non-synonymous changes (from 3D7 reference).</p>
<section id="process-sequence-data" class="level3">
<h3 class="anchored" data-anchor-id="process-sequence-data">Process Sequence Data</h3>
<p>AIMS: - Remove symbols: <code>*!-</code> - Separate SeqID code into “Isolate”, “MID”, “MID_N”, “Pool”, “Date”, “Haplotype” - Create haplotype specific to marker</p>
<p>INPUTS:</p>
<ul>
<li>*All_NT_Aligned.csv Use as the sequence file and create haplotypes (e.g., CVMNT)</li>
</ul>
<p>OUTPUTS:</p>
<ul>
<li>05_All_DrugR_NT_Sequences/Controls/*Controls_Haps.csv</li>
<li>05_All_DrugR_NT_Sequences/Isolates/*Isolates_Haps.csv</li>
<li>05_All_DrugR_NT_Sequences/Repeats/*Repeats_Haps.csv</li>
<li>05_All_DrugR_Haplotypes/temp/*Haps_only.csv</li>
</ul>
<p>The <code>Controls_Haps</code>, <code>Isolates_Haps</code> and <code>Repeats_Haps</code> files will contain the haplotype (Haps), the entire sequence separated by codon number and other info (SeqID, Reference and Marker). The <code>Haps_only</code> file will only contain the haplotype information (for the corresponding SeqID, Reference and Marker).</p>
</section>
<section id="process-codon-match-data" class="level3">
<h3 class="anchored" data-anchor-id="process-codon-match-data">Process Codon Match Data</h3>
<p>INPUTS:</p>
<ul>
<li>*All_NT_Aligned_YorN.csv: Use to determine how many NT changes from 3D7 reference (e.g., 1 change)</li>
<li>*All_AA_Aligned_YorN.csv: Use to determine how many AA changes from 3D7 reference (e.g., 1 change)</li>
</ul>
<p>OUTPUTS:</p>
<ul>
<li>*All_NT_Aligned_YorN_Count.csv: Collapsed into a column of the total number of NT differences</li>
<li>*All_AA_Aligned_YorN_Count.csv: Collapsed into a column of the total number of AA differences</li>
</ul>
</section>
<section id="process-codon-differences" class="level3">
<h3 class="anchored" data-anchor-id="process-codon-differences">Process Codon Differences</h3>
<p>INPUTS:</p>
<ul>
<li>*All_NT_Aligned_NTchange.csv: Use to determine the actual NT change from 3D7 reference (e.g., AAA76ACA)</li>
<li>*All_AA_Aligned_AAchange.csv: Use to determine the actual AA change from 3D7 reference (e.g., K76T)</li>
</ul>
<p>OUTPUTS:</p>
<ul>
<li>*All_NT_Aligned_NTchange_Final.csv: Contains a collapsed column with all NT changes</li>
<li>*All_NT_Aligned_AAchange_Final.csv: Contains a collapsed column with all AA changes</li>
</ul>
</section>
<section id="join-data" class="level3">
<h3 class="anchored" data-anchor-id="join-data">Join Data</h3>
<p>INPUTS:</p>
<p>All/temp/files Includes <code>_Haps.csv</code>, <code>YorN_Counts.csv</code>, <code>change_Final.csv</code> for both NT and AA (separated for each Fraction cut-off to analyse and marker)</p>
<p>OUTPUTS:</p>
<ul>
<li>Isolates_Final_Haps</li>
<li>Controls_Final_Haps</li>
<li>Repeats_Final_Haps</li>
</ul>
<p>All input files are merged at similar columns “SeqID”, “Marker” and “Reference”</p>
</section>
</section>
<section id="step-03-specific-changes-dhps-2-and-mdr1-2" class="level2">
<h2 class="anchored" data-anchor-id="step-03-specific-changes-dhps-2-and-mdr1-2">Step 03: Specific Changes: dhps-2 and mdr1-2</h2>
<p>Both dhps-2 and mdr1-2 contain isolates that appear to have SAME genotype but are said to be in different clusters.</p>
<p>CHALLENGE: For dhps-2 there is a string of A’s that are variable. PROPOSED SOLUTION: Remove codons 520 and 520.1 (corresponding to nucleotides 50 to 75 in the sequence files). Also NOTE: MID 47 (TGTGAGTAGT, <a href="https://www.yumpu.com/en/document/read/24794008/roche-mid-adapters">Roche</a>) exists within the dhps-2 amplicon sequence. Our current SeekDeep parameters account for this by only searching for the MID in the first 8 nucleotides of the amplicon.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Nucleotides 50 to 75</th>
<th>n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TTAAAAAAAAAAAAAAACAAATTCT</td>
<td>2</td>
</tr>
<tr class="even">
<td>TTAAAAAAAAAAAAAACAAATTCTA</td>
<td>204</td>
</tr>
<tr class="odd">
<td>TTAAAAAAAAAAAAACAAATTCTAT</td>
<td>18</td>
</tr>
<tr class="even">
<td>TTAAAAAAAAAAAACAAATTCTATA</td>
<td>1790</td>
</tr>
<tr class="odd">
<td>TTAAAAAAAAAACAAATTCTATAGT</td>
<td>964</td>
</tr>
<tr class="even">
<td>TTAAAAAAAAAAACAAATTCTATAG</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>CHALLENGE: I found that this is because for mdr1-2, either the last one or last six nucleotide differ. PROPOSED SOLUTION: Remove codons 1077, 1078, 1079.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Last 6 nucleotides</th>
<th>n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AAAATG</td>
<td>1088</td>
</tr>
<tr class="even">
<td>AAAATT</td>
<td>981</td>
</tr>
<tr class="odd">
<td>TTTCTG</td>
<td>550</td>
</tr>
</tbody>
</table>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./2_MACSE.html" class="pagination-link" aria-label="Step 2: MACSE">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Step 2: MACSE</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Dionne C. Argyropoulos</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/UniMelb-Day-Lab">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/DionneArgy">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>